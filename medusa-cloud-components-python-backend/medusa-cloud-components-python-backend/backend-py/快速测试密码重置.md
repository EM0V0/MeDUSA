# å¿«é€Ÿæµ‹è¯•å¯†ç é‡ç½®åŠŸèƒ½

## ğŸ§ª æœ¬åœ°æµ‹è¯•

### 1. å¯åŠ¨æœ¬åœ°åç«¯

```powershell
cd backend-py
.\start_local.ps1
```

åç«¯å°†åœ¨ `http://localhost:8000` å¯åŠ¨

### 2. æµ‹è¯•å¯†ç é‡ç½®ç«¯ç‚¹

ä½¿ç”¨ curl æˆ– Postman æµ‹è¯•ï¼š

```powershell
# æµ‹è¯•å¯†ç é‡ç½®
curl -X POST http://localhost:8000/api/v1/auth/reset-password `
  -H "Content-Type: application/json" `
  -d '{\"email\":\"demo@medusa.com\",\"newPassword\":\"newpassword123\"}'
```

**é¢„æœŸå“åº”** (200 OK):
```json
{
  "success": true,
  "message": "Password reset successful"
}
```

**é”™è¯¯å“åº”** (404 - ç”¨æˆ·ä¸å­˜åœ¨):
```json
{
  "detail": {
    "code": "USER_NOT_FOUND",
    "message": "Account not found"
  }
}
```

**é”™è¯¯å“åº”** (400 - å¯†ç å¤ªçŸ­):
```json
{
  "detail": {
    "code": "INVALID_PASSWORD",
    "message": "Password must be at least 8 characters"
  }
}
```

### 3. å®Œæ•´çš„å¯†ç é‡ç½®æµç¨‹æµ‹è¯•

#### Step 1: æ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦æˆ·
```powershell
curl -X POST http://localhost:8000/api/v1/auth/register `
  -H "Content-Type: application/json" `
  -d '{\"email\":\"test@example.com\",\"password\":\"password123\",\"role\":\"patient\"}'
```

#### Step 2: ä½¿ç”¨åŸå¯†ç ç™»å½•ï¼ˆéªŒè¯è´¦æˆ·ï¼‰
```powershell
curl -X POST http://localhost:8000/api/v1/auth/login `
  -H "Content-Type: application/json" `
  -d '{\"email\":\"test@example.com\",\"password\":\"password123\"}'
```

#### Step 3: é‡ç½®å¯†ç 
```powershell
curl -X POST http://localhost:8000/api/v1/auth/reset-password `
  -H "Content-Type: application/json" `
  -d '{\"email\":\"test@example.com\",\"newPassword\":\"newpassword456\"}'
```

#### Step 4: ä½¿ç”¨æ–°å¯†ç ç™»å½•
```powershell
curl -X POST http://localhost:8000/api/v1/auth/login `
  -H "Content-Type: application/json" `
  -d '{\"email\":\"test@example.com\",\"password\":\"newpassword456\"}'
```

**åº”è¯¥æˆåŠŸè¿”å› JWT token!**

## ğŸŒ äº‘ç«¯æµ‹è¯•

### éƒ¨ç½²åˆ° AWS

```powershell
cd ..
.\deploy.ps1
```

### è·å– API URL

éƒ¨ç½²æˆåŠŸåï¼Œå¤åˆ¶ API Gateway URLï¼Œä¾‹å¦‚ï¼š
```
https://abc123def.execute-api.us-east-1.amazonaws.com/Prod/
```

### æ›´æ–° Flutter é…ç½®

åœ¨ `lib/shared/services/network_service.dart` ä¸­æ›´æ–°ï¼š

```dart
// ç”Ÿäº§ç¯å¢ƒ API URL
static const String productionBaseUrl = 'https://YOUR-API-URL.execute-api.us-east-1.amazonaws.com/Prod/api/v1';
```

### æµ‹è¯•

```powershell
# æ›¿æ¢ä¸ºä½ çš„å®é™… API URL
$API_URL = "https://YOUR-API-URL.execute-api.us-east-1.amazonaws.com/Prod"

# æµ‹è¯•å¯†ç é‡ç½®
curl -X POST "$API_URL/api/v1/auth/reset-password" `
  -H "Content-Type: application/json" `
  -d '{\"email\":\"test@example.com\",\"newPassword\":\"cloudpass123\"}'
```

## ğŸ“± Flutter åº”ç”¨æµ‹è¯•

### 1. ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ API URL

æ£€æŸ¥ `service_locator.dart`:
```dart
static const bool useMockAuth = false; // ä½¿ç”¨çœŸå®åç«¯
```

### 2. è¿è¡Œåº”ç”¨

```powershell
cd meddevice-app-flutter-main
flutter run -d windows
```

### 3. æµ‹è¯•å¯†ç é‡ç½®æµç¨‹

1. ç‚¹å‡»ç™»å½•é¡µé¢çš„ "Forgot Password?"
2. è¾“å…¥é‚®ç®±: `test@example.com`
3. ç‚¹å‡» "Send Verification Code"
4. æŸ¥çœ‹æ§åˆ¶å°è·å–éªŒè¯ç ï¼ˆMock æ¨¡å¼ï¼‰
5. è¾“å…¥éªŒè¯ç 
6. è®¾ç½®æ–°å¯†ç ï¼ˆè‡³å°‘8ä¸ªå­—ç¬¦ï¼‰
7. ç‚¹å‡» "Reset Password"
8. åº”è¯¥çœ‹åˆ°æˆåŠŸæ¶ˆæ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
9. ä½¿ç”¨æ–°å¯†ç ç™»å½•

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: 405 Method Not Allowed
**åŸå› **: åç«¯æ²¡æœ‰éƒ¨ç½²æœ€æ–°ä»£ç 
**è§£å†³**: é‡æ–°éƒ¨ç½²åç«¯

### é—®é¢˜ 2: 404 User Not Found
**åŸå› **: é‚®ç®±ä¸å­˜åœ¨
**è§£å†³**: å…ˆæ³¨å†Œè¯¥é‚®ç®±è´¦æˆ·

### é—®é¢˜ 3: 400 Invalid Password
**åŸå› **: å¯†ç å°‘äº8ä¸ªå­—ç¬¦
**è§£å†³**: ä½¿ç”¨è‡³å°‘8ä¸ªå­—ç¬¦çš„å¯†ç 

### é—®é¢˜ 4: CORS é”™è¯¯
**åŸå› **: åç«¯ CORS é…ç½®é—®é¢˜
**è§£å†³**: æ£€æŸ¥ main.py ä¸­çš„ CORS é…ç½®

### é—®é¢˜ 5: å¯†ç æœªçœŸæ­£æ›´æ–°
**åŸå› **: DynamoDB å†™å…¥å¤±è´¥
**è§£å†³**: æ£€æŸ¥ AWS CloudWatch æ—¥å¿—

## ğŸ“Š ç›‘æ§

### æŸ¥çœ‹ CloudWatch æ—¥å¿—

```powershell
# è·å–æœ€æ–°æ—¥å¿—
aws logs tail /aws/lambda/medusa-backend-function --follow
```

### æŸ¥çœ‹ DynamoDB æ•°æ®

```powershell
# æŸ¥çœ‹ç”¨æˆ·è¡¨
aws dynamodb scan --table-name medusa-users
```

## âœ… æˆåŠŸæ ‡å¿—

- âœ… åç«¯è¿”å› 200 çŠ¶æ€ç 
- âœ… å“åº”åŒ…å« `{"success": true}`
- âœ… å¯ä»¥ä½¿ç”¨æ–°å¯†ç ç™»å½•
- âœ… åŸå¯†ç æ— æ³•ç™»å½•
- âœ… Flutter åº”ç”¨æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯

## ğŸ“ API è§„èŒƒ

### Endpoint
```
POST /api/v1/auth/reset-password
```

### Request Body
```json
{
  "email": "user@example.com",
  "newPassword": "newpassword123"
}
```

### Success Response (200)
```json
{
  "success": true,
  "message": "Password reset successful"
}
```

### Error Responses

**404 - ç”¨æˆ·ä¸å­˜åœ¨**:
```json
{
  "detail": {
    "code": "USER_NOT_FOUND",
    "message": "Account not found"
  }
}
```

**400 - å¯†ç å¤ªçŸ­**:
```json
{
  "detail": {
    "code": "INVALID_PASSWORD",
    "message": "Password must be at least 8 characters"
  }
}
```

---

**æµ‹è¯•å®Œæˆåè®°å¾—æ›´æ–°æ–‡æ¡£ï¼** âœ¨

