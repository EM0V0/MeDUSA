# AWS SES é…ç½®æŒ‡å— - å¯ç”¨çœŸå®é‚®ä»¶å‘é€

**ç›®æ ‡**: è®©ç”¨æˆ·åœ¨æ³¨å†Œ/å¯†ç é‡ç½®æ—¶æ”¶åˆ°çœŸå®çš„éªŒè¯ç é‚®ä»¶

---

## ğŸ“‹ å‰ææ¡ä»¶

- âœ… AWS è´¦æˆ·
- âœ… è®¿é—® AWS Console çš„æƒé™
- âœ… ä¸€ä¸ªæœ‰æ•ˆçš„é‚®ç®±ï¼ˆç”¨ä½œå‘ä»¶äººï¼‰

---

## ğŸ”§ Step 1: åœ¨ AWS Console é…ç½® SES

### 1.1 ç™»å½• AWS Console

1. è®¿é—®: https://console.aws.amazon.com/ses/
2. ç¡®ä¿åŒºåŸŸé€‰æ‹©ä¸º: **US East (N. Virginia) us-east-1**

### 1.2 éªŒè¯å‘ä»¶äººé‚®ç®±

#### é€‰é¡¹ A: ä½¿ç”¨ä½ è‡ªå·±çš„é‚®ç®±ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰

1. ç‚¹å‡»å·¦ä¾§èœå• **"Identities"**
2. ç‚¹å‡» **"Create identity"**
3. é€‰æ‹© **"Email address"**
4. è¾“å…¥ä½ çš„é‚®ç®±ï¼ˆä¾‹å¦‚ï¼š`andysun12@outlook.com`ï¼‰
5. ç‚¹å‡» **"Create identity"**
6. âœ‰ï¸ **æ£€æŸ¥ä½ çš„é‚®ç®±**ï¼Œä¼šæ”¶åˆ°ä¸€å°æ¥è‡ª AWS çš„éªŒè¯é‚®ä»¶
7. **ç‚¹å‡»é‚®ä»¶ä¸­çš„éªŒè¯é“¾æ¥**
8. è¿”å› AWS Consoleï¼ŒçŠ¶æ€åº”è¯¥å˜ä¸º **"Verified"** âœ…

#### é€‰é¡¹ B: ä½¿ç”¨åŸŸåé‚®ç®±ï¼ˆç”¨äºç”Ÿäº§ï¼‰

å¦‚æœä½ æœ‰è‡ªå·±çš„åŸŸåï¼ˆå¦‚ medusa-health.comï¼‰ï¼š

1. ç‚¹å‡» **"Create identity"**
2. é€‰æ‹© **"Domain"**
3. è¾“å…¥åŸŸåï¼š`medusa-health.com`
4. æŒ‰ç…§æŒ‡ç¤ºæ·»åŠ  DNS è®°å½•ï¼ˆDKIM, SPFï¼‰
5. ç­‰å¾…éªŒè¯å®Œæˆ

### 1.3 ç§»å‡ºæ²™ç›’æ¨¡å¼ï¼ˆå¯é€‰ä½†æ¨èï¼‰

**æ²™ç›’æ¨¡å¼é™åˆ¶**ï¼š
- âŒ åªèƒ½å‘é€åˆ°å·²éªŒè¯çš„é‚®ç®±
- âŒ æ¯å¤©æœ€å¤š 200 å°é‚®ä»¶
- âŒ æ¯ç§’æœ€å¤š 1 å°é‚®ä»¶

**ç§»å‡ºæ²™ç›’æ­¥éª¤**ï¼š

1. åœ¨ SES Consoleï¼Œç‚¹å‡»å·¦ä¾§ **"Account dashboard"**
2. æŸ¥çœ‹ **"Sending statistics"** éƒ¨åˆ†
3. å¦‚æœæ˜¾ç¤º "Sandbox"ï¼Œç‚¹å‡» **"Request production access"**
4. å¡«å†™ç”³è¯·è¡¨æ ¼ï¼š
   - **Mail type**: Transactional
   - **Website URL**: ä½ çš„åº”ç”¨ç½‘ç«™ï¼ˆæˆ–è¾“å…¥ `https://github.com/your-repo`ï¼‰
   - **Use case description**: 
     ```
     MeDUSA is a medical device monitoring system that sends email verification 
     codes during user registration and password reset. We expect to send 
     approximately 100-500 verification emails per day to healthcare professionals.
     ```
   - **Bounce and complaint handling**: We will monitor bounce rates and complaints
5. æäº¤ç”³è¯·ï¼ˆé€šå¸¸ 24 å°æ—¶å†…æ‰¹å‡†ï¼‰

**æ³¨æ„**: åœ¨æ²™ç›’æ¨¡å¼ä¸‹ï¼Œä½ ä»ç„¶å¯ä»¥æµ‹è¯•ï¼Œä½†**æ”¶ä»¶äººé‚®ç®±ä¹Ÿéœ€è¦åœ¨ SES ä¸­éªŒè¯**ã€‚

---

## ğŸ” Step 2: é…ç½® IAM æƒé™

### 2.1 ä¸º Lambda æ·»åŠ  SES æƒé™

ä½ çš„ Lambda å‡½æ•°éœ€è¦å‘é€é‚®ä»¶çš„æƒé™ã€‚

#### æ–¹æ³• A: é€šè¿‡ AWS Console

1. è®¿é—®: https://console.aws.amazon.com/iam/
2. ç‚¹å‡» **"Roles"**
3. æœç´¢ä½ çš„ Lambda æ‰§è¡Œè§’è‰²ï¼š`medusa-api-v3-stack-MedusaAPIFunctionRole-*`
4. ç‚¹å‡»è§’è‰²åç§°
5. ç‚¹å‡» **"Add permissions"** â†’ **"Attach policies"**
6. æœç´¢ **"AmazonSESFullAccess"**ï¼ˆæˆ–åˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥ï¼‰
7. é€‰ä¸­å¹¶ç‚¹å‡» **"Add permissions"**

#### æ–¹æ³• B: é€šè¿‡ SAM template.yamlï¼ˆæ¨èï¼‰

æˆ‘å°†åœ¨ä¸‹ä¸€æ­¥æ›´æ–° `template.yaml` æ–‡ä»¶æ¥è‡ªåŠ¨æ·»åŠ æƒé™ã€‚

---

## ğŸ“ Step 3: æ›´æ–°åç«¯ä»£ç 

ç°åœ¨è®©æˆ‘æ›´æ–°åç«¯é…ç½®æ–‡ä»¶...

---

## ğŸ§ª Step 4: æµ‹è¯•é…ç½®

### 4.1 åœ¨æ²™ç›’æ¨¡å¼ä¸‹æµ‹è¯•

å¦‚æœä½ è¿˜åœ¨æ²™ç›’æ¨¡å¼ï¼Œéœ€è¦éªŒè¯æ”¶ä»¶äººé‚®ç®±ï¼š

1. åœ¨ SES Consoleï¼Œç‚¹å‡» **"Identities"** â†’ **"Create identity"**
2. éªŒè¯ä½ æƒ³æµ‹è¯•çš„æ”¶ä»¶äººé‚®ç®±ï¼ˆä¾‹å¦‚ï¼š`test@example.com`ï¼‰
3. æ£€æŸ¥è¯¥é‚®ç®±å¹¶ç‚¹å‡»éªŒè¯é“¾æ¥

### 4.2 å‘é€æµ‹è¯•é‚®ä»¶

éƒ¨ç½²æ›´æ–°åï¼Œæµ‹è¯•æ³¨å†Œæµç¨‹ï¼š

```bash
# æµ‹è¯•å‘é€éªŒè¯ç 
curl -X POST "https://YOUR-API-URL/Prod/api/v1/auth/send-verification-code" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-verified-email@example.com",
    "code": "123456",
    "type": "registration"
  }'
```

**æ£€æŸ¥é‚®ç®±** - ä½ åº”è¯¥æ”¶åˆ°ä¸€å°æ¼‚äº®çš„ HTML é‚®ä»¶ï¼

---

## ğŸ“Š SES ç›‘æ§

### æŸ¥çœ‹å‘é€ç»Ÿè®¡

1. è®¿é—® SES Console
2. ç‚¹å‡» **"Account dashboard"**
3. æŸ¥çœ‹ï¼š
   - å‘é€æ•°é‡
   - é€€ä¿¡ç‡ï¼ˆBounce rateï¼‰
   - æŠ•è¯‰ç‡ï¼ˆComplaint rateï¼‰

### è®¾ç½®é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

1. åœ¨ SES Consoleï¼Œç‚¹å‡» **"Identities"**
2. é€‰æ‹©ä½ çš„é‚®ç®±èº«ä»½
3. ç‚¹å‡» **"Notifications"** æ ‡ç­¾
4. é…ç½® SNS ä¸»é¢˜æ¥æ”¶é€€ä¿¡å’ŒæŠ•è¯‰é€šçŸ¥

---

## ğŸ’° è´¹ç”¨ä¼°ç®—

**AWS SES å®šä»·**ï¼ˆus-east-1ï¼‰ï¼š
- å‰ 62,000 å°é‚®ä»¶/æœˆï¼š**$0.10 per 1,000 emails**
- ä¹‹åï¼š$0.10 per 1,000 emails
- æ¥æ”¶é‚®ä»¶ï¼šå…è´¹ï¼ˆå‰ 1,000 å°ï¼‰

**ç¤ºä¾‹**ï¼š
- 100 ä¸ªç”¨æˆ·æ³¨å†Œ = 100 å°é‚®ä»¶ = **$0.01**
- 1,000 ä¸ªç”¨æˆ·æ³¨å†Œ = 1,000 å°é‚®ä»¶ = **$0.10**

éå¸¸ä¾¿å®œï¼ ğŸ’°

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: é‚®ä»¶æœªæ”¶åˆ°

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] å‘ä»¶äººé‚®ç®±å·²éªŒè¯ï¼ˆVerified çŠ¶æ€ï¼‰
- [ ] åœ¨æ²™ç›’æ¨¡å¼ï¼Œæ”¶ä»¶äººé‚®ç®±ä¹Ÿéœ€éªŒè¯
- [ ] Lambda æœ‰ SES æƒé™
- [ ] æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
- [ ] æŸ¥çœ‹ CloudWatch æ—¥å¿—é”™è¯¯

### é—®é¢˜ 2: "MessageRejected" é”™è¯¯

```
AccessDenied: User is not authorized to perform: ses:SendEmail
```

**è§£å†³æ–¹æ³•**ï¼š
- ä¸º Lambda æ·»åŠ  SES æƒé™ï¼ˆè§ Step 2ï¼‰

### é—®é¢˜ 3: é‚®ä»¶è¿›å…¥åƒåœ¾ç®±

**è§£å†³æ–¹æ³•**ï¼š
- é…ç½® SPFã€DKIMã€DMARC è®°å½•
- ä½¿ç”¨åŸŸåé‚®ç®±è€Œä¸æ˜¯ä¸ªäººé‚®ç®±
- ç§»å‡ºæ²™ç›’æ¨¡å¼

### é—®é¢˜ 4: æ²™ç›’æ¨¡å¼é™åˆ¶

```
Email address is not verified. The following identities failed the check in region US-EAST-1
```

**è§£å†³æ–¹æ³•**ï¼š
- éªŒè¯æ”¶ä»¶äººé‚®ç®±
- æˆ–ç”³è¯·ç§»å‡ºæ²™ç›’æ¨¡å¼

---

## ğŸ“§ é‚®ä»¶ç¤ºä¾‹

ç”¨æˆ·å°†æ”¶åˆ°å¦‚ä¸‹é‚®ä»¶ï¼š

### æ³¨å†ŒéªŒè¯é‚®ä»¶

```
å‘ä»¶äºº: MeDUSA Health System <noreply@medusa-health.com>
ä¸»é¢˜: Email Verification Code - MeDUSA

[ç¾è§‚çš„ HTML é‚®ä»¶]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
MeDUSA Health System
Email Verification
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Verify Your Email Address

Thank you for registering with MeDUSA Health System. 
To complete your registration, please use the following 
verification code:

    1 2 3 4 5 6

This code will expire in 10 minutes.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â© 2025 MeDUSA Health System
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

### AWS SES
- [ ] å·²ç™»å½• AWS Console
- [ ] åŒºåŸŸè®¾ç½®ä¸º us-east-1
- [ ] å‘ä»¶äººé‚®ç®±å·²éªŒè¯ âœ…
- [ ] ï¼ˆæ²™ç›’æ¨¡å¼ï¼‰æµ‹è¯•æ”¶ä»¶äººé‚®ç®±å·²éªŒè¯
- [ ] ï¼ˆå¯é€‰ï¼‰å·²ç”³è¯·ç§»å‡ºæ²™ç›’

### IAM æƒé™
- [ ] Lambda è§’è‰²æœ‰ SES æƒé™
- [ ] æƒé™ç­–ç•¥å·²é™„åŠ 

### ä»£ç æ›´æ–°
- [ ] template.yaml å·²æ›´æ–°ï¼ˆä¸‹ä¸€æ­¥ï¼‰
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ä»£ç å·²éƒ¨ç½²

### æµ‹è¯•
- [ ] æµ‹è¯•é‚®ä»¶å‘é€æˆåŠŸ
- [ ] åœ¨é‚®ç®±ä¸­æ”¶åˆ°éªŒè¯ç 
- [ ] éªŒè¯ç æ ¼å¼æ­£ç¡®
- [ ] é‚®ä»¶æ ·å¼ç¾è§‚

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

**æœ€ç®€å•çš„æµ‹è¯•æ–¹æ³•**ï¼ˆæ²™ç›’æ¨¡å¼ï¼‰ï¼š

1. âœ… éªŒè¯ä½ çš„å‘ä»¶äººé‚®ç®±ï¼ˆä¾‹å¦‚ï¼š`andysun12@outlook.com`ï¼‰
2. âœ… éªŒè¯åŒä¸€ä¸ªé‚®ç®±ä½œä¸ºæ”¶ä»¶äººï¼ˆåŒä¸€ä¸ªé‚®ç®±ï¼‰
3. âœ… åœ¨ä»£ç ä¸­è®¾ç½® `SENDER_EMAIL` ä¸ºä½ çš„é‚®ç®±
4. âœ… éƒ¨ç½²æ›´æ–°
5. âœ… ä½¿ç”¨ä½ çš„é‚®ç®±æ³¨å†Œæµ‹è¯•
6. âœ… æ£€æŸ¥é‚®ç®± - æ”¶åˆ°éªŒè¯ç ï¼

---

ç°åœ¨è®©æˆ‘æ›´æ–°é…ç½®æ–‡ä»¶...

